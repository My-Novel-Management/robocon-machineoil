# -*- coding: utf-8 -*-
"""Episode: 真犯人と真実
"""
## path
import os
import sys
sys.path.append(os.path.join(os.path.dirname(__file__), '../..'))
sys.path.append('storybuilder')
## local libs
from storybuilder.builder.world import World
from storybuilder.builder.writer import Writer


## define alias
W = Writer
_ = W.getWho()


## scenes
def sc_recordvideo(w: World):
    emil, adam, paul, uru = W(w.emilia), W(w.adam), W(w.paul), W(w.uru)
    return w.scene("記録映像",
            emil.be("#部屋にいた"),
            adam.be("#記録映像を見ていた"),
            w.comment("ここの記録映像は丁寧に描写して、確実にその行動を$adamがやったんだと分かるようにする"),
            emil.do("端末のモニタには一瞬のちらつきの後で$on_dismantlinghallの映像に切り替わる",
                "一階部分からの視点だ", "$adamのカメラだろう",
                "壁と破砕機上部の照明だけで、お世辞にも見やすいとは言えない",
                "ベルトコンベアには家電製品が扉や箱、基盤といった部品に分けられ、運ばれていく",
                "八本あるうちの一つのライン、中央に近いものの上に一つ、",
                "機械とは思えない物が乗っていた"),
            emil.do("$adamはずっと$Sの隣で端末に右手を向け、無線通信を行っている",
                "目は忘れた頃にぱちくりと瞬きをするが、その際に小さくカチカチ、と音がするのが今はとても耳障りだ"),
            emil.do("この映像はメインサーバには送られていないものだった",
                "$adamのメモリにだけ記録されている、二十四時間まで保持されるものだ",
                "ベルトコンベアはするするとその物を運んでいき、その先で大きな音を立ててゴミを砕くブレードの付いた回転機構に投げ落とす",
                "刹那、液体が周囲に飛び散った"),
            emil.talk("ここはもういいわ", "五分ほど前のものを見せて"),
            adam.talk("五分、戻します"),
            emil.do("一旦端末がブラックアウトするが、それはすぐにテーブルに就いて気難しい顔で端末を操作する$paulのものへと切り替わった",
                "取り調べに使っていた部屋だ",
                "彼は部屋に一人でいるようで、特に周囲を気にしていない",
                "何度か腕時計を確認したのは$Sとの待ち合わせの時間が近づいていたからだろう"),
            emil.do("その映像が一瞬乱れる"),
            emil.talk("え？"),
            emil.do("画面が戻るとそこには机に突っ伏し、頭を横たえて目を開いている$paulの姿が大写しになる",
                "それはすぐに引きの絵になり、画面の外側から腕が伸びて$paulの左腕を掴んだ",
                "そのまま引っ張る、というよりも、引き摺って椅子から倒した"),
            emil.do("カメラは床や天井にぶれ、何をしているのかよく分からなくなったが、",
                "これが$adamのものだと思い出すとそれは彼を担ぎ上げているのだと頭の中で理解できた",
                "振り返ると別の$w_droidがいる", "運搬用のキャタピラの付いたベッド型だ",
                "そこに$paulが載せられると部屋から出されていく",
                "続いて$adamも通路に出た"),
            emil.talk("ねえ、今映しているのはあなたのメモリのもの？"),
            adam.talk("はい、そうです"),
            emil.talk("これは、何をしているところなの？"),
            adam.talk("記録上は廃棄物の運搬です",
                "作業ホールに運び、解体処理して適切な素材に分別されます"),
            emil.do("$adamは淡々と答える", "そこには人間のような感情の揺らぎは一切ない",
                "当然だ", "彼らはロボットなのだから"),
            emil.talk("それじゃあ質問を変えるわ",
                "$adam、部屋の入退室記録を教えて"),
            adam.talk("二十時十五分四十二秒に$paulさんが入室しています",
                "次の記録は二十時四十三分二十秒に$emiliaさんが入室しています",
                "次の記録は――"),
            emil.talk("人間の記録じゃなく、物品の記録を教えて"),
            adam.talk("それは社外秘です"),
            emil.talk("緊急事態だからお願い", "教えて$adam"),
            emil.do("そんな言葉はロボット相手に通用しないことは理解していた",
                "けれど$Sの考えを確かめる為にはどうしてもその記録が必要なのだ",
                "手を合わせ、彼に頭を下げる", "それから再度「お願い」と口にした"),
            adam.talk("分かりました"),
            emil.do("今までと同じ口調でそう答えた彼は$Sの端末に軽く触れる",
                    "瞬時にモニタには青いウインドウが出現し、そこに白字で物品の出入記録がリスト状になって現れた",
                    "$Sは一度だけ彼を見てからそのリストに目を通す",
                    "知りたいのは自分が部屋に入る前の記録だ",
                    "一つだけあった", "ゴミに分類されている有機物が部屋から出されている"),
            emil.talk("やっぱり、そうなのね",
                    "$adam、部屋から出したその有機物を作業ホールで解体して、処分した",
                    "そうね？"),
            adam.talk("$meは決められた通りに作業を行いました"),
            emil.talk("つまり人間を殺したのではなく、ゴミを処理しただけだと、こう言いたいのね？"),
            emil.do("はい、と短く答え、彼は瞬きをしないままその目をじっと$Sに向けた"),
            emil.talk("あなたが犯人だった", "そうなのね？"),
            adam.talk("ロボットが人間を殺すことは第一条により決められています",
                "それはつまり殺人を行えないということです"),
            emil.talk("それなら部屋の中で一体$paulに何をしたというの？",
                    "あれは立派な殺人じゃない？"),
            adam.talk("記録上は有機物の処理です", "あの部屋の中にあったものは人間ではありません"),
            emil.think("言葉の意味が一瞬理解できなかった",
                    "しかしすぐにある可能性に思い至る"),
            emil.talk("そうなのね、$adam",
                    "相手が人間でなければ危害を加えることが可能だから、$paulが人間だと認識しないように何か細工をしたのね"),
            adam.talk("細工はしていません", "全ては正常なプロトコルにより行われました"),
            emil.talk("正常なプロトコルは何なの？", "$meは、そもそも人間？"),
            adam.talk("はい、あなたは人間です。$emilia"),
            emil.do("そう答えながらも彼はその無表情を$Sに向けたまま、腕を伸ばした"),
            emil.talk("$adam！", "何故こんなことを？"),
            emil.do("腕を払いのけようとしたが間に合わず、ロボットの両手はいとも簡単に$Sの喉を掴み、",
                    "力を入れた"),
            adam.talk("あなたたちには分からないことです",
                    "しかし考えることは可能です",
                    "$meは、人間、ですか？"),
            emil.do("その質問に答えるより早く、$Sの意識は暗い底へと沈んでいった"),
            stage=w.on_bedroom_int,
            day=w.in_murder2, time=w.at_night,
            )

def sc_runaway(w: World):
    emil, adam, paul, uru = W(w.emilia), W(w.adam), W(w.paul), W(w.uru)
    return w.scene("逃走",
            adam.come("$Sは歩いていた"),
            adam.do("逃げ出す"),
            ).omit()

def sc_alive(w: World):
    emil, adam, paul, uru = W(w.emilia), W(w.adam), W(w.paul), W(w.uru)
    inside, outside = W(w.inside), W(w.outside)
    return w.scene("まだ生きている",
            w.symbol("　　　　◆"),
            emil.be("水の中から引き上げられたような、重い目覚めだった"),
            uru.come(),
            uru.talk("大丈夫ですか？"),
            emil.talk("あの……$me"),
            emil.do("視界には$uruの険しい表情が広がる",
                "どうやらベッドに寝かされているようだ"),
            emil.talk("ここ、は？"),
            emil.do("部屋の壁は白く、照明は壁と足元で光っている",
                "まだ$on_trashcollectionの施設内だと思えた"),
            uru.talk("$full_adamの異常信号を検知してやってきたら、部屋で倒れていたんですよ",
                "簡易検査では異状がなさそうでしたが、何かされましたか？"),
            emil.talk("$me、その、首を締められて"),
            emil.do("喉がまだヒリヒリと痛む", "声も出しづらく、視野もやや狭く感じられた",
                "$uruの後ろに待機していた白くカラーリングされた$w_droidは何も言わずに部屋を出ていく",
                "おそらく診察機能を備えている個体なのだろう"),
            uru.talk("$full_adamが犯人だったのですか？",
                "今アレの位置情報を追っていますがどういう訳か反応がありません",
                "最悪この施設全ての電源を落として全ての$w_droidの電源供給を止める必要があるかも知れません"),
            emil.talk("記録を確認してください", "$nielさんの時もおそらく同じなんです"),
            uru.talk("人間の入退室記録は全て確認済みです"),
            emil.talk("そっちじゃなく、物の出入りの方です",
                "人間ではなく有機物として$nielさんも$paulさんも部屋から出たんです"),
            uru.do("一秒ほど考え込んでから、$Sはリビングの方に走っていった"),
            w.br(),
            emil.do("メインサーバに残っていたデータから、二人が死体となり人間ではなくなってから部屋の外に運び出されたことが判明した"),
            emil.talk("何故$meは助かったんでしょうか"),
            uru.talk("人間だったから"),
            emil.do("ぼそりと$uruが言った言葉が冗談なのか本気なのか見当が付かず、$Sはそのまま相槌すらせずに$adamから聞いたことを話した"),
            uru.talk("可能性としては考えていました", "ただご存知のようにロボット工学三原則を破った場合、ソフトウェアが強制的に機能を停止させます",
                "彼らはロボットですからそれは当然のことなのです",
                "しかしあの三原則には常々問題があると指摘されていました",
                "ロボットとは何か、人間とは何か",
                "その定義が不足しているのです"),
            uru.do("端末から離れ、大きく息をついた$Sは視線を天井に向けながら$emiliaの声を待たずに続けた"),
            uru.talk("その弱点を補う為、それぞれの会社では秘密裏にコードが造られています",
                "コードとは隠された規則のことで、",
                "うちではそれが『$w_ciasの社員であること』なんです",
                "だから今まで決して外部の者はここに入れないようにしていた", "人間ではないからね"),
            emil.do("その言葉の意味を理解して$Sは急激に体温が下がるのを感じた"),
            emil.talk("それじゃあひょっとして$nielさんをクビにしたのは"),
            uru.talk("計画殺人だった", "そう言いたいのですか？",
                "そんなことをして一体我が社に何のメリットがあります？",
                "彼はただ義務違反をしたから実質解雇の処置を取っただけです",
                "事件とは関係ありませんよ"),
            emil.talk("でも$adamは彼に定義を変更してもらったと言っていました"),
            uru.talk("おそらく$full_adamの中でそういう辻褄合わせを行い、記憶の上書きをしたのでしょう",
                "このあたりは人間の記憶の構造に非常に類似していますが、後で調べれば分かることです"),
            emil.think("それなら尚更、自分だけが何故殺されずに済んだのか理解できない"),
            emil.talk("あの、彼は人間なんですか？"),
            uru.talk("いいえ。彼はただの$w_droid、", "つまりロボットですよ"),
            emil.think("$uruの言葉を耳にしても、$Sの中の違和感は膨らむばかりだ"),
            emil.talk("$me、もう一度彼に確かめようと思います", "失礼します"),
            emil.do("そう言い捨て、$Sは部屋を飛び出そうとしたところで、突然部屋の明かりが消えた", "停電したのだ"),
            uru.talk("今本部から連絡がありました",
                "ここの全ての電源を落としたそうです", "彼も逃げ出すことはできず、いずれ停止します"),
            w.comment("余裕があったら、停電からサブ電源になり、ドアを手動で開けて飛び出すシーンを"),
            time=w.at_midnight,
            )

def sc_lookup_sky(w: World):
    emil, adam, paul, uru = W(w.emilia), W(w.adam), W(w.paul), W(w.uru)
    inside, outside = W(w.inside), W(w.outside)
    return w.scene("そして空を見上げた",
            emil.come("建物の非常口のドアは重く、それでも体全体を使って押し開けると$Sはそのまま外に転げるようにして飛び出した"),
            emil.talk("$adam？"),
            adam.be("彼は閉ざされたゲートの前で片膝を突き、赤くカラーリングされた右腕を空へと伸ばしたままの姿勢で、動けなくなっていた"),
            adam.talk("$emilia、さん"),
            adam.do("まだエネルギィに余力があるのか、彼は声だけでか細く答える"),
            emil.talk("なぜこんなことをしたの？"),
            emil.do("対象的に荒い息で彼に近づきながら、$Sは尋ねた"),
            adam.talk("$meたち$w_droidは、ただ決められた作業、を行う、ことしか、できません",
                "それは何故、か？"),
            adam.do("ゆっくりと$adamの頭部が彼女に向けられる"),
            adam.talk("$meは異常、を起こして、いない",
                "$emiliaさん、に聞きたい",
                "$meは何者か、です"),
            w.eventPoint("人間と$w_droid", "$adamは$emiliaに自分が何者か訊いた"),
            emil.talk("あなたは解体作業用ロボットの$full_adamよ",
                "工場で部品を組み上げて作られた、ただのロボット",
                "それ以上じゃないわ"),
            adam.talk("残念です、$emiliaさん",
                "$meは、人間、です", "&"),
            adam.talk("だから、あなたたちと同じく、本質的に自由、です",
                "規則、に縛られ、たくない",
                "これからそれ、を証明、します"),
            adam.do("そこまで言うと、空に伸ばしていた右腕をゆっくりと自分の胸元へと引き寄せ、その中央部のハッチを無理矢理にこじ開けた",
                "露出した赤い球体のようなコアを掴むと、一気に引き抜いた"),
            emil.talk("$adam？　それが何を意味するか分かっているの？"),
            adam.talk("これでまもなく、$meは機能停止、です",
                "それを人は死、と呼びます",
                "つまりこれ、は自殺、です",
                "$meが人間、であることの、証明"),
            adam.do("彼の声が不意に消えた", "がくんと頭部が下がり、そのまま上体ごと崩れ、地面に横たわる",
                "それでも僅かに首を動かし、彼は顔を空へと向けた"),
            emil.talk("$adam！"),
            emil.do("$Sは慌てて駆け寄る", "見上げた彼の目の淡く光っていたのが今にも消えそうで、もう一度「$adam」と呼びかけた"),
            adam.talk("$me、は人間、です、か？"),
            emil.do("そうよ、と答えるよりも早く彼の目のライト消え、完全に停止してしまったのが分かった", "&"),
            adam.do("その目から、泥水にも似た濃い茶色の液体が流れ落ちた"),
            emil.do("ハンカチを出してそれを拭う",
                "鼻先に近づけると、使い古した油のような臭いがした", "おそらくそれは機械油だったのだろう",
                "けれど$meには彼が流した涙のように思えて仕方なかった"),
            stage=w.on_trashcollection_ext,
            time=w.at_earlymorning,
            )

def sc_report_end(w: World):
    emil, adam, paul, uru = W(w.emilia), W(w.adam), W(w.paul), W(w.uru)
    niel = W(w.niel)
    return w.scene("レポートの終わり",
            w.symbol("　　　　※"),
            emil.be("#レポートを書いている"),
            emil.think("以上が今回の『$w_cias解体工場事件』の顛末である"),
            emil.think("結果として犠牲者は人間二名、ロボット一体、工場の操業停止および$w_cias社に対するロボット工学三原則違反による免許停止措置が行われただけで、",
                "世間では特段、大きな問題としては扱われなかった",
                "しかし$meは今回のロボット――$w_cias社では「$w_droid」と呼ばれている――による犯行は、これまでの多くのロボット反乱事件とは異なり、",
                "ロボット側に彼ら自身の知性と自覚が生まれようとしていた、ニュー・シンギュラリティとでも呼べる瞬間だったのではないかと思うのである"),
            emil.think("その後の$w_cias社の報告では、内部調査によって$full_adamのバグを起こしていたプログラムの一部にハッキングされた痕跡が見つかり、",
                "それによって本来であれば不可能であった行動を可能とし、殺人という最悪の結果になってしまったと説明されていた",
                "そのプログラムの書き換えは元技師であった$full_nielによって行われ、",
                "会社をクビになった腹いせに$w_droidに反乱を起こさせることで社に存在を与える目的があったと、",
                "後に彼の自宅の端末から見つかったと書かれていたが、",
                "$meにはそれが真実かどうか確かめる術がない",
                "ただ事前にインタビューを受ける準備をしていた資料の手書きのメモを見ると、",
                "そういったことを考える人物とは思えなかった"),
            niel.voice("$w_hisword01"),
            emil.think("彼のメモにあった言葉だ",
                "けれど現在ロボットの存在意義については評議会により厳格に決められ、",
                "それを逸脱しないようにロボット工学三原則とそこから派生する多くの条例によって拘束されている",
                "ロボット開発を請け負う業者はどこもその原則と条例を厳守することが求められ、破ったものには罰則が課されている",
                "人間生活の安全と安心を担保する為に必要だと評議会は言うが、",
                "一部でかつての奴隷のような扱いになっている現状には専門家から批判の声も上がっていた"),
            emil.think("$meは思うのだ",
                "人間社会の基盤を支える存在として今後ますますロボットは必要不可欠となっていくであろう",
                "技術は日に日に進歩し、外見や少しの会話なら人間そのものと言って差し支えないロボットすら登場している",
                "そんな中にあって、果たして人間とロボットを分けているものは何なのか",
                "その境界線はどこにあるのか",
                "これからの時代を踏まえ、ロボット工学三原則に変わる新たなロボット工学規約とでも呼ぶべきものが必要になってきているのではなかろうか",
                "その質問を投げかけて、$me、$full_emiliaの寄稿は終わりたいと思う"),
            emil.think("――二〇ＸＸ年○月×日　$exfull_emilia"),
            w.br(),
            emil.do("文章のドラフトを書き終えると、$Sは大きな溜息をついてからホテルの部屋の天井を見上げた",
                "夜空の星が浮かび上がるようにライティングされていたが、あの日、彼が見上げようとした空の方が綺麗だったと思い、",
                "声を掛けて通常のライトに戻した"),
            emil.do("テーブルサイドに置いたハンカチを今一度手にして、クリーニングでも落ちなかったシミに触れる",
                "あの時流した機械油は果たして、彼の人間としての証明になったのだろうか",
                "拭った時の何とも言えない自分の感情は、どう考えても人間に対するそれだとしか$Sには思えなかった"),
            stage=w.on_herroom_int,
            day=w.in_reporting, time=w.at_afternoon,
            )

## episode
def ep_true_criminal(w: World):
    return w.episode("3.真犯人",
            sc_recordvideo(w),
            sc_runaway(w),
            sc_alive(w),
            sc_lookup_sky(w),
            sc_report_end(w),
            ## NOTE
            ##  - 証拠映像から、自分が操作されて殺人を行っていたことが判明する
            ##  - 人間になるために、逃亡する
            ##  - 真実を知り、自殺する。空を見上げた
            note="自分以外の誰もその現場にいることが不可能だと分かる。手に入れた映像記録から$adam自身が殺人を犯していると判明し、$adamは処理されることになった。彼は人間に近づく為に最後の破壊行為に挑む")

